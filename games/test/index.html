<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <style>
        html, body {
            background: #fff;
            height: 100%;
            margin: 0px;
            padding: 0px;
            overflow-y: scroll;
            overflow-x: clip;
        }

        h1, h2 {
            margin: 0px;
            padding: 0px 0px 10px 0px;
        }

        p {
            margin: 5px 0px;
        }

        .container {
            margin: auto;
            max-width: 768px;
        }

        .section {
            border: 2px solid #cecece;
            padding: 20px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section" id="options-section">
            <h2>Instant Games Bridge Sandbox</h2>
            <button id="initialize-button">Initialize</button>
        </div>

        <div class="section" id="platform-section">
            <h2>Platform</h2>
            <p>ID: <span id="platform-id-text"></span></p>
            <p>Language: <span id="platform-language-text"></span></p>
            <p>Payload: <span id="platform-payload-text"></span></p>
        </div>

        <div class="section" id="device-section">
            <h2>Device</h2>
            <p>Type: <span id="device-type-text"></span></p>
        </div>

        <div class="section" id="player-section">
            <h2>Player</h2>
            <p>Is Authorization Supported: <span id="is-player-authorization-supported-text"></span></p>
            <p>Is Authorized: <span id="is-player-authorized-text"></span></p>
            <p>ID: <span id="player-id-text"></span></p>
            <p>Name: <span id="player-name-text"></span></p>
            <p>Photos: <span id="player-photos-text"></span></p>
            <hr>
            <label for="authorize-player-yandex-scopes-input">Yandex: Authorization Scopes</label>
            <input type="checkbox" id="authorize-player-yandex-scopes-input" >
            <br>
            <br>
            <button id="authorize-player-button">Authorize</button>
        </div>

        <div class="section" id="game-section">
            <h2>Game</h2>
            <input type="text" id="game-data-coins-input" placeholder="Coins" />
            <input type="text" id="game-data-level-input" placeholder="Level" />
            <br>
            <br>
            <button id="get-game-data-button">Get Data</button>
            <button id="set-game-data-button">Set Data</button>
            <button id="delete-game-data-button">Delete Data</button>
        </div>

        <div class="section" id="advertisement-section">
            <h2>Advertisement</h2>
            <input type="text" id="advertisement-minimum-delay-between-interstitial-input" placeholder="Minimum Delay Between Interstitial" />
            <button id="advertisement-set-minimum-delay-between-interstitial-button">Set Minimum Delay Between Interstitial</button>
            <br><br>
            <p>Interstitial State: <span id="advertisement-interstitial-state-text"></span></p>
            <p>Rewarded State: <span id="advertisement-rewarded-state-text"></span></p>
            <br>
            <button id="advertisement-show-interstitial-button">Show Interstitial</button>
            <button id="advertisement-show-interstitial-ignore-delay-button">Show Interstitial (ignore delay)</button>
            <button id="advertisement-show-rewarded-button">Show Rewarded</button>
        </div>

        <div class="section" id="social-section">
            <h2>Social</h2>
            <p>Is Share Supported: <span id="social-is-share-supported-text"></span></p>
            <p>Is Invite Friends Supported: <span id="social-is-invite-friends-supported-text"></span></p>
            <p>Is Join Community Supported: <span id="social-is-join-community-supported-text"></span></p>
            <p>Is Create Post Supported: <span id="social-is-create-post-supported-text"></span></p>
            <p>Is Add To Home Screen Supported: <span id="social-is-add-to-home-screen-supported-text"></span></p>
            <p>Is Add To Favorites Supported: <span id="social-is-add-to-favorites-supported-text"></span></p>
            <p>Is Rate Supported: <span id="social-is-rate-supported-text"></span></p>
            <br>

            <button id="social-invite-friends-button">Invite Friends</button>
            <button id="social-add-to-home-screen-button">Add To Home Screen</button>
            <button id="social-add-to-favorites-button">Add To Favorites</button>
            <button id="social-rate-button">Rate</button>
            <br>
            <br>
            <input type="text" id="social-vk-share-link-input" placeholder="VK: Link" />
            <button id="social-share-button">Share</button>
            <br>
            <br>
            <input type="text" id="social-vk-group-id-input" placeholder="VK: Group ID" />
            <button id="social-join-community-button">Join Community</button>
            <br>
            <br>
            <input type="text" id="social-create-post-message-input" placeholder="VK: Message" />
            <input type="text" id="social-create-post-attachments-input" placeholder="VK: Attachments" />
            <button id="social-create-post-button">Create Post</button>
        </div>

        <div class="section" id="leaderboard-section">
            <h2>Leaderboard</h2>
            <p>Is Supported: <span id="leaderboard-is-supported-text"></span></p>
            <p>Is Native Popup Supported: <span id="leaderboard-is-native-popup-supported-text"></span></p>
            <p>Is Multiple Boards Supported: <span id="leaderboard-is-multiple-boards-supported-text"></span></p>
            <p>Is Set Score Supported: <span id="leaderboard-is-set-score-supported-text"></span></p>
            <p>Is Get Score Supported: <span id="leaderboard-is-get-score-supported-text"></span></p>
            <p>Is Get Entries Supported: <span id="leaderboard-is-get-entries-supported-text"></span></p>
            <hr>
            <br>
            <input type="text" id="leaderboard-board-id-input" placeholder="Yandex: Board Name" />
            <input type="text" id="leaderboard-score-input" placeholder="Score" />
            <button id="leaderboard-set-score-button">Set Score</button>
            <button id="leaderboard-get-score-button">Get Score</button>
            <br><br>
            <hr>
            <br>
            <label for="leaderboard-vk-global-input">VK: Global</label>
            <input type="checkbox" id="leaderboard-vk-global-input">
            <br>
            <br>
            <button id="leaderboard-show-native-popup-button">Show Native Popup</button>
            <br>
            <br>
            <hr>
            <br>
            <label for="leaderboard-yandex-include-user-input">Yandex: Include User</label>
            <input type="checkbox" id="leaderboard-yandex-include-user-input">
            <br>
            <input type="text" id="leaderboard-yandex-quantity-around-input" placeholder="Yandex: Quantity Around">
            <br>
            <input type="text" id="leaderboard-yandex-quantity-top-input" placeholder="Yandex: Quantity Top">
            <br>
            <br>
            <button id="leaderboard-get-entries-button">Get Entries</button>
            <p id="leaderboard-entries-container"></p>
        </div>

        <div class="section" id="payments">
            <h2>Payments</h2>
            <p>Is supported: <span id="payments-is-supported-text"></span></p>
            <br>
            <input type="text" id="payments-item-title-input" placeholder="Item name" />
            <button id="show-order-payments-button">Show order payments</button>
            <br>
            <p>Order result: <span id="order-payments-result"></span></p>            
        </div>
    </div>

    <script src="./instant-games-bridge.js"></script>
    <script>
        const optionsSection = document.getElementById('options-section')
        const platformSection = document.getElementById('platform-section')
        const deviceSection = document.getElementById('device-section')
        const playerSection = document.getElementById('player-section')
        const gameSection = document.getElementById('game-section')
        const advertisementSection = document.getElementById('advertisement-section')
        const socialSection = document.getElementById('social-section')
        const leaderboardSection = document.getElementById('leaderboard-section')
        const payments = document.getElementById('payments')

        platformSection.style.display = 'none'
        deviceSection.style.display = 'none'
        playerSection.style.display = 'none'
        gameSection.style.display = 'none'
        advertisementSection.style.display = 'none'
        socialSection.style.display = 'none'
        leaderboardSection.style.display = 'none'
        payments.style.display = 'none'

        const platformIdText = document.getElementById('platform-id-text')
        const platformLanguageText = document.getElementById('platform-language-text')
        const platformPayloadText = document.getElementById('platform-payload-text')
        const initializeButton = document.getElementById('initialize-button')

        const deviceTypeText = document.getElementById('device-type-text')

        const isPlayerAuthorizationSupportedText = document.getElementById('is-player-authorization-supported-text')
        const isPlayerAuthorizedText = document.getElementById('is-player-authorized-text')
        const playerIdText = document.getElementById('player-id-text')
        const playerNameText = document.getElementById('player-name-text')
        const playerPhotosText = document.getElementById('player-photos-text')
        const authorizePlayerYandexScopesInput = document.getElementById('authorize-player-yandex-scopes-input')
        const authorizePlayerButton = document.getElementById('authorize-player-button')

        const gameDataCoinsInput = document.getElementById('game-data-coins-input')
        const gameDataLevelInput = document.getElementById('game-data-level-input')
        const getGameDataButton = document.getElementById('get-game-data-button')
        const setGameDataButton = document.getElementById('set-game-data-button')
        const deleteGameDataButton = document.getElementById('delete-game-data-button')

        const advertisementMinimumDelayBetweenInterstitialInput = document.getElementById('advertisement-minimum-delay-between-interstitial-input')
        const advertisementSetMinimumDelayBetweenInterstitialButton = document.getElementById('advertisement-set-minimum-delay-between-interstitial-button')
        const advertisementInterstitialStateText = document.getElementById('advertisement-interstitial-state-text')
        const advertisementRewardedStateText = document.getElementById('advertisement-rewarded-state-text')
        const advertisementShowInterstitialButton = document.getElementById('advertisement-show-interstitial-button')
        const advertisementShowInterstitialIgnoreDelayButton = document.getElementById('advertisement-show-interstitial-ignore-delay-button')
        const advertisementShowRewardedButton = document.getElementById('advertisement-show-rewarded-button')

        const socialIsShareSupportedText = document.getElementById('social-is-share-supported-text')
        const socialIsInviteFriendsSupportedText = document.getElementById('social-is-invite-friends-supported-text')
        const socialIsJoinCommunitySupportedText = document.getElementById('social-is-join-community-supported-text')
        const socialIsCreatePostSupportedText = document.getElementById('social-is-create-post-supported-text')
        const socialIsAddToHomeScreenSupportedText = document.getElementById('social-is-add-to-home-screen-supported-text')
        const socialIsAddToFavoritesSupportedText = document.getElementById('social-is-add-to-favorites-supported-text')
        const socialIsRateSupportedText = document.getElementById('social-is-rate-supported-text')
        const socialVkGroupIdInput = document.getElementById('social-vk-group-id-input')
        const socialVkShareLinkInput = document.getElementById('social-vk-share-link-input')
        const socialShareButton = document.getElementById('social-share-button')
        const socialInviteFriendsButton = document.getElementById('social-invite-friends-button')
        const socialJoinCommunityButton = document.getElementById('social-join-community-button')
        const socialCreatePostMessageInput = document.getElementById('social-create-post-message-input')
        const socialCreatePostAttachmentsInput = document.getElementById('social-create-post-attachments-input')
        const socialCreatePostButton = document.getElementById('social-create-post-button')
        const socialAddToHomeScreenButton = document.getElementById('social-add-to-home-screen-button')
        const socialAddToFavoritesButton = document.getElementById('social-add-to-favorites-button')
        const socialRateButton = document.getElementById('social-rate-button')

        const leaderboardIsSupportedText = document.getElementById('leaderboard-is-supported-text')
        const leaderboardIsNativePopupSupportedText = document.getElementById('leaderboard-is-native-popup-supported-text')
        const leaderboardIsMultipleBoardsSupportedText = document.getElementById('leaderboard-is-multiple-boards-supported-text')
        const leaderboardIsGetScoreSupportedText = document.getElementById('leaderboard-is-get-score-supported-text')
        const leaderboardIsSetScoreSupportedText = document.getElementById('leaderboard-is-set-score-supported-text')
        const leaderboardIsGetEntriesSupportedText = document.getElementById('leaderboard-is-get-entries-supported-text')
        const leaderboardIdInput = document.getElementById('leaderboard-board-id-input')
        const leaderboardScoreInput = document.getElementById('leaderboard-score-input')
        const leaderboardSetScoreButton = document.getElementById('leaderboard-set-score-button')
        const leaderboardGetScoreButton = document.getElementById('leaderboard-get-score-button')
        const leaderboardVkGlobalInput = document.getElementById('leaderboard-vk-global-input')
        const leaderboardShowNativePopupButton = document.getElementById('leaderboard-show-native-popup-button')
        const leaderboardYandexIncludeUserInput = document.getElementById('leaderboard-yandex-include-user-input')
        const leaderboardYandexQuantityAroundInput = document.getElementById('leaderboard-yandex-quantity-around-input')
        const leaderboardYandexQuantityTopInput = document.getElementById('leaderboard-yandex-quantity-top-input')
        const leaderboardGetEntriesButton = document.getElementById('leaderboard-get-entries-button')
        const leaderboardEntriesContainer = document.getElementById('leaderboard-entries-container')

        const paymentsIsSupportedText = document.getElementById('payments-is-supported-text')
        const paymentsItemTitleInput = document.getElementById('payments-item-title-input')
        const paymentsShowOrderButton = document.getElementById('show-order-payments-button')
        const orderPaymentsResult = document.getElementById('order-payments-result')

        initializeButton.addEventListener('click', () => {
            if (instantGamesBridge.isInitialized)
                return

            instantGamesBridge
                .initialize()
                .then(() => {

                    optionsSection.style.display = 'none'
                    initializeButton.disabled = 'disabled'

                    platformIdText.innerText = instantGamesBridge.platform.id
                    platformLanguageText.innerText = instantGamesBridge.platform.language
                    platformPayloadText.innerText = instantGamesBridge.platform.payload

                    deviceTypeText.innerText = instantGamesBridge.device.type

                    isPlayerAuthorizationSupportedText.innerText = instantGamesBridge.player.isAuthorizationSupported
                    isPlayerAuthorizedText.innerText = instantGamesBridge.player.isAuthorized

                    if (instantGamesBridge.player.isAuthorized) {
                        playerIdText.innerText = instantGamesBridge.player.id
                        playerNameText.innerText = instantGamesBridge.player.name
                        playerPhotosText.innerText = instantGamesBridge.player.photos
                    }

                    socialIsShareSupportedText.innerText = instantGamesBridge.social.isShareSupported
                    socialIsInviteFriendsSupportedText.innerText = instantGamesBridge.social.isInviteFriendsSupported
                    socialIsJoinCommunitySupportedText.innerText = instantGamesBridge.social.isJoinCommunitySupported
                    socialIsCreatePostSupportedText.innerText = instantGamesBridge.social.isCreatePostSupported
                    socialIsAddToHomeScreenSupportedText.innerText = instantGamesBridge.social.isAddToHomeScreenSupported
                    socialIsAddToFavoritesSupportedText.innerText = instantGamesBridge.social.isAddToFavoritesSupported
                    socialIsRateSupportedText.innerText = instantGamesBridge.social.isRateSupported

                    advertisementMinimumDelayBetweenInterstitialInput.value = instantGamesBridge.advertisement.minimumDelayBetweenInterstitial

                    instantGamesBridge.advertisement.on('interstitial_state_changed', state => {
                        advertisementInterstitialStateText.innerText = state
                    })

                    instantGamesBridge.advertisement.on('rewarded_state_changed', state => {
                        advertisementRewardedStateText.innerText = state
                    })

                    leaderboardIsSupportedText.innerText = instantGamesBridge.leaderboard.isSupported
                    leaderboardIsNativePopupSupportedText.innerText = instantGamesBridge.leaderboard.isNativePopupSupported
                    leaderboardIsMultipleBoardsSupportedText.innerText = instantGamesBridge.leaderboard.isMultipleBoardsSupported
                    leaderboardIsGetScoreSupportedText.innerText = instantGamesBridge.leaderboard.isGetScoreSupported
                    leaderboardIsSetScoreSupportedText.innerText = instantGamesBridge.leaderboard.isSetScoreSupported
                    leaderboardIsGetEntriesSupportedText.innerText = instantGamesBridge.leaderboard.isGetEntriesSupported

                    paymentsIsSupportedText.innerText = instantGamesBridge.payments.isSupported

                    platformSection.style.display = 'block'
                    deviceSection.style.display = 'block'
                    playerSection.style.display = 'block'
                    gameSection.style.display = 'block'
                    advertisementSection.style.display = 'block'
                    socialSection.style.display = 'block'
                    leaderboardSection.style.display = 'block'
                    payments.style.display = 'block'
                })
        })

        authorizePlayerButton.addEventListener('click', () => {
            instantGamesBridge
                .player
                .authorize({ yandex: { scopes: authorizePlayerYandexScopesInput.checked }})
                .then(() => {
                    isPlayerAuthorizedText.innerText = instantGamesBridge.player.isAuthorized
                    playerIdText.innerText = instantGamesBridge.player.id
                    playerNameText.innerText = instantGamesBridge.player.name
                    playerPhotosText.innerText = instantGamesBridge.player.photos
                })
        })

        getGameDataButton.addEventListener('click', () => {
            instantGamesBridge
                .game
                .getData('player_progress')
                .then(playerProgress => {
                    if (playerProgress) {
                        gameDataCoinsInput.value = playerProgress.coins
                        gameDataLevelInput.value = playerProgress.level
                    }
                })
        })

        setGameDataButton.addEventListener('click', () => {
            instantGamesBridge
                .game
                .setData('player_progress', { coins: gameDataCoinsInput.value, level: gameDataLevelInput.value })
        })

        deleteGameDataButton.addEventListener('click', () => {
            instantGamesBridge
                .game
                .deleteData('player_progress')
                .then(() => {
                    gameDataCoinsInput.value = ''
                    gameDataLevelInput.value = ''
                })
        })

        advertisementSetMinimumDelayBetweenInterstitialButton.addEventListener('click', () => {
            let value = advertisementMinimumDelayBetweenInterstitialInput.value
            instantGamesBridge.advertisement.setMinimumDelayBetweenInterstitial(value)
            advertisementMinimumDelayBetweenInterstitialInput.value = instantGamesBridge.advertisement.minimumDelayBetweenInterstitial
        })

        advertisementShowInterstitialButton.addEventListener('click', () => {
            instantGamesBridge.advertisement.showInterstitial()
        })

        advertisementShowInterstitialIgnoreDelayButton.addEventListener('click', () => {
            instantGamesBridge.advertisement.showInterstitial({ ignoreDelay: true })
        })

        advertisementShowRewardedButton.addEventListener('click', () => {
            instantGamesBridge.advertisement.showRewarded()
        })

        socialShareButton.addEventListener('click', () => {
            let data = {
                vk: {
                    link: socialVkShareLinkInput.value
                }
            }

            instantGamesBridge.social.share(data)
        })

        socialInviteFriendsButton.addEventListener('click', () => {
            instantGamesBridge.social.inviteFriends()
        })

        socialJoinCommunityButton.addEventListener('click', () => {
            instantGamesBridge.social.joinCommunity({ vk: { groupId: socialVkGroupIdInput.value } })
        })

        socialCreatePostButton.addEventListener('click', () => {
            let data = {
                vk: {
                    message: socialCreatePostMessageInput.value,
                    attachments: socialCreatePostAttachmentsInput.value,
                }
            }
            instantGamesBridge.social.createPost(data)
        })

        socialAddToHomeScreenButton.addEventListener('click', () => {
            instantGamesBridge.social.addToHomeScreen()
        })

        socialAddToFavoritesButton.addEventListener('click', () => {
            instantGamesBridge.social.addToFavorites()
        })

        socialRateButton.addEventListener('click', () => {
            instantGamesBridge.social.rate()
        })

        leaderboardGetScoreButton.addEventListener('click', () => {
            instantGamesBridge
                .leaderboard
                .getScore({ yandex: { leaderboardName: leaderboardIdInput.value } })
                .then(score => {
                    if (score)
                        leaderboardScoreInput.value = score
                })
        })

        leaderboardSetScoreButton.addEventListener('click', () => {
            instantGamesBridge
                .leaderboard
                .setScore({ yandex: { score: leaderboardScoreInput.value, leaderboardName: leaderboardIdInput.value }})
        })

        leaderboardShowNativePopupButton.addEventListener('click', () => {
            let score = leaderboardScoreInput.value
            if (!score)
                score = 1

            instantGamesBridge
                .leaderboard
                .showNativePopup({ vk: { userResult: score, global: leaderboardVkGlobalInput.checked } })
        })

        leaderboardGetEntriesButton.addEventListener('click', () => {
            instantGamesBridge
                .leaderboard
                .getEntries({
                    yandex: {
                        leaderboardName: leaderboardIdInput.value,
                        quantityTop: leaderboardYandexQuantityTopInput.value,
                        includeUser: leaderboardYandexIncludeUserInput.checked,
                        quantityAround: leaderboardYandexQuantityAroundInput.value
                    }
                })
                .then(data => {
                    let text = ''
                    data.forEach(e => {
                        text += 'ID: ' + e.id + ', name: ' + e.name + ', score: ' + e.score + ', rank: ' + e.rank + ', small photo: ' + e.photos[0]
                    })
                    leaderboardEntriesContainer.innerText = text
                })
        })

        paymentsShowOrderButton.addEventListener('click', () => {
            console.log(paymentsItemTitleInput.value)
            instantGamesBridge.payments
            .showOrderPayments({itemTitle: paymentsItemTitleInput.value})
            .then(orderResult => {
                console.log(orderResult)
                orderPaymentsResult.innerText = orderResult
            })
        })
    </script>
</body>
</html>
